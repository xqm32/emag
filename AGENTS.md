# AGENTS.md

## 项目信息

- **项目名称**: Osmos (WebGPU/WebGL2 细胞吞噬游戏)
- **主要文件**: `index.html`（单文件架构）

## 开发约定

### Git 操作

- ✅ **可以自动执行**: `git add` 和 `git commit`
- ❌ **不要自动执行**: `git push`
- **Push 前**: 必须询问用户确认

### 项目特点

- 单文件 HTML 游戏，代码结构化为 17 个模块

### 渲染

- **WebGPU** 优先渲染器（WGSL 着色器），自动检测
- **WebGL2** 回退渲染器（GLSL 着色器）
- 渲染器抽象接口统一 `{ type, resize(), render() }`
- 实例化渲染（instanced drawing）最高支持 5000 实例
- 左下角显示当前渲染器类型

### 游戏机制

- 7 阶段渐进难度系统 + 通关后可续玩**无尽模式**
- 点击/触屏**喷射质量**移动（动量守恒物理）
- 无全局摩擦力环境（纯惯性宇宙）
- 吞噬比自己小的细胞，躲避比自己大的
- 吞噬判定：20% 质量优势才能吃 + 渐进式吸收
- **护盾机制**：shield 使有效质量增大
- **逆境资源**：质量过低时自动补给小资源
- **持续生成**：每秒在玩家附近生成微型资源

### 肉鸽系统

- 每 30 秒触发 buff 选择（3 选 1）
- 19 种可叠加 buff，分 3 个稀有度：
  - **普通 (6种)**：节能喷射、贪婪吞噬、轻盈移动、缓慢生长、阻力制动、黏滞领域
  - **稀有 (7种)**：强力喷射、视野扩展、缓冲护盾、快速成长、绝地反击、追击惯性、质量稳定
  - **史诗 (6种)**：吸血之触、时间扭曲、引力井、质能转换、顶级掠食者、泥沼领域
- 每种 buff 有专属 SVG 图标
- 右侧显示已激活 buff 列表及叠加层数

### AI 系统

- 5 种 AI 性格：攻击型、防御型、懒惰型、探索型、随机型
- 每个 NPC 独立的速度倍率、视野范围、反应时间、攻击性、失误率
- AI 更新频率节流至 30fps

### 性能优化

- **帧缓存 (frameCache)**：避免每帧重复 `filter()`/`sort()`
- **视锥体裁剪**：`buildInstances` 跳过屏幕外物体
- **空间网格碰撞**：200px 网格 + 标记清理
- **粒子对象池**：1500 对象池复用，避免 GC
- **UI 节流**：DOM 更新 10fps + 值变化时才写入
- **碰撞对键位运算**：`(i << 16) | j` 支持 65536 实体
- **死亡清理**：每 120 帧压缩 cells 数组
- `'use strict'` 模式

### 操作

- 鼠标点击 / 触屏：喷射质量（距离越远喷射越多）
- 长按：连续喷射（80ms 间隔）
- 滚轮 / 双指捏合：缩放视野
- 底部按钮：慢速 / 暂停 / 正常 / 快速
- R 键：重新开始
- 空格键：暂停/继续切换

### UI 元素

- 左上：质量显示、阶段进度、排名
- 右上：已激活 buff 列表
- 右下：速度+方向显示
- 底部：时间控制按钮 + 速度标签
- 右侧：缩放控制
- 准星：渐变轨迹提示 + 十字光标 + 方向箭头

## 用户偏好

- 提交信息要清晰描述改动内容
- 视觉调整需要反复确认（如粒子效果）
- 重要操作前需要询问确认
